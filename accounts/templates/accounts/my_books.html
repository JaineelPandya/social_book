{% extends 'base/base.html' %}
{% load static %}

{% block title %}My Books - Social Book{% endblock %}

{% block extra_css %}
<style>
  .sticky-header {
    position: sticky;
    top: 0;
    z-index: 1000;
    background: #fff;
    border-bottom: 1px solid #e0e0e0;
    padding: 1rem 0;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05)
  }

  .book-card {
    background: #fff;
    border-radius: 10px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    box-shadow: 0 8px 24px rgba(18, 21, 46, 0.04);
    transition: transform .18s
  }

  .book-card:hover {
    transform: translateY(-4px)
  }

  .pdf-icon {
    color: #ff5370;
    font-size: 2.5rem;
    margin-right: 1.5rem
  }

  .book-info {
    flex: 1
  }

  .empty-state {
    text-align: center;
    padding: 3rem;
    color: #666
  }

  .empty-state i {
    font-size: 4rem;
    color: #ccc;
    margin-bottom: 1rem
  }
</style>
{% endblock %}

{% block content %}
<!-- Sticky Header -->
<div class="sticky-header">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center">
      <h4 style="margin:0">My Books</h4>
      <div>
        <a href="{% url 'upload_books' %}" class="btn btn-primary btn-sm">
          <i class="icon-copy dw dw-upload"></i> Upload New Book
        </a>
        <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary btn-sm">Dashboard</a>
      </div>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="container pd-20 pd-sm-40">
  <div class="page-header mb-30">
    <div class="row">
      <div class="col-md-12">
        <h2 class="mb-2">Your Uploaded Books</h2>
        <p class="text-muted">Manage and download your book collection</p>
      </div>
    </div>
  </div>

  {% if uploaded_files %}
  <div class="row">
    {% for file in uploaded_files %}
    <div class="col-md-6 mb-3">
      <div class="book-card">
        <div class="d-flex align-items-start">
          <div class="pdf-icon">
            <i class="icon-copy dw dw-file-1"></i>
          </div>
          <div class="book-info">
            <h4 style="margin:0 0 0.5rem 0">{{ file.title }}</h4>
            <p class="text-muted mb-2" style="font-size:0.9rem">
              {{ file.description|default:"No description provided"|truncatewords:25 }}
            </p>

            <div class="mb-2">
              <span class="badge badge-{{ file.visibility }}">
                {% if file.visibility == 'public' %}
                <i class="icon-copy dw dw-worldwide"></i> Public
                {% elif file.visibility == 'private' %}
                <i class="icon-copy dw dw-lock"></i> Private
                {% else %}
                <i class="icon-copy dw dw-user-2"></i> Followers Only
                {% endif %}
              </span>
              {% if file.cost > 0 %}
              <span class="badge badge-success">${{ file.cost }}</span>
              {% else %}
              <span class="badge badge-info">Free</span>
              {% endif %}
            </div>

            <div class="d-flex justify-content-between align-items-center mb-2">
              <div>
                <small class="text-muted">
                  <i class="icon-copy dw dw-calendar1"></i> {{ file.uploaded_at|date:"M d, Y" }}
                </small>
              </div>
              <div>
                <small class="text-muted">
                  <i class="icon-copy dw dw-download"></i> {{ file.get_file_size_display }}
                </small>
              </div>
            </div>

            <div class="d-flex gap-2">
              <a href="{{ file.file.url }}" class="btn btn-primary btn-sm" download>
                <i class="icon-copy dw dw-download"></i> Download PDF
              </a>
              <a href="{% url 'file_detail' file.id %}" class="btn btn-outline-secondary btn-sm">
                <i class="icon-copy dw dw-eye"></i> View Details
              </a>
              <form method="post" action="{% url 'delete_file' file.id %}" style="display:inline"
                onsubmit="return confirm('Are you sure you want to delete this book?')">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-danger btn-sm">
                  <i class="icon-copy dw dw-delete-3"></i> Delete
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="card">
    <div class="card-body">
      <div class="empty-state">
        <i class="icon-copy dw dw-library"></i>
        <h4>No books uploaded yet</h4>
        <p class="mb-3">Start building your library by uploading your first book</p>
        <a href="{% url 'upload_books' %}" class="btn btn-primary">
          <i class="icon-copy dw dw-upload"></i> Upload Your First Book
        </a>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<style>
  .badge-public {
    background: #3bba9f;
    color: #fff
  }

  .badge-private {
    background: #ff5370;
    color: #fff
  }

  .badge-followers {
    background: #fdb366;
    color: #fff
  }

  .d-flex.gap-2 {
    gap: 0.5rem
  }
</style>
{% endblock %}